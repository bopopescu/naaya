<metal:block metal:use-macro="view/site/standard_template_macro">

<metal:block metal:fill-slot="title">
    <title><tal:block i18n:translate="">Observatory Map</tal:block> |
    <span tal:replace="view/site/site_title" /></title>
</metal:block>

<metal:block metal:fill-slot="head">
    <meta tal:attributes="content view/site/gl_get_selected_language"
        name="dc.language" />
    <meta i18n:attributes="content"
        content="Interactive map for the Observatory information"
        name="description" />

<link rel="stylesheet" type="text/css" media="screen" href="++resource++naaya.observatory.maptool/css/box.css" />
<!--[if lt IE 8]>
<link rel="stylesheet" type="text/css" media="screen" href="++resource++naaya.observatory.maptool/css/ie6.css" />
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" media="screen" href="++resource++naaya.observatory.maptool/css/ie8.css" />
<![endif]-->

<script type="text/javascript" language="Javascript" src="++resource++naaya.observatory.maptool/js/le.js"></script>
<script type="text/javascript" language="Javascript" src="++resource++naaya.observatory.maptool/js/bg.js"></script>
<script type="text/javascript" language="Javascript" src="++resource++naaya.observatory.maptool/js/effects.js"></script>
<script type="text/javascript" language="Javascript" src="++resource++naaya.observatory.maptool/js/functions.js"></script>
<script type="text/javascript" language="Javascript" src="++resource++naaya.observatory.maptool/js/pngfix.js"></script>
</metal:block>

<metal:block metal:fill-slot="body">
<tal:block tal:define="
    session_key python:view.set_session(request);
    path python:request.get('path', '');
    height python:request.get('height', view.portal_map.map_height_px)">
<tal:block content="structure python:view.setup_map_engine_html(request)" />
<script type="text/javascript" tal:attributes="src string:${view/portal_map/absolute_url}/map_i18n_js"></script>
<script type="text/javascript" src="++resource++naaya.observatory.maptool/js/maptool.js"></script>
<script tal:content="structure python:'var portal_url=%s;' % view.site.rstk.json_dumps(view.site.absolute_url())"></script>

<form action="." name="frmFilterMap" method="get" id="frmFilterMap">
    <div id="center_content" style="width: 78%; overflow-x: auto;">
        <h1 i18n:translate="" tal:content="view/site/title_or_id" />
        <noscript>
            <p i18n:translate="" class="message-information">You must have Javascript turned on to access all the Geo Map features.</p>
        </noscript>
        <p id="js_links" style="display: none; height: 2em">
            <span i18n:translate="">Displaying </span>
            <strong id="record_counter"></strong>
            <span i18n:translate="">pin(s).</span>
        </p>
        <div id="map" tal:attributes="style string:width: 100%;; height: ${height}px;;"></div>
        <br clear="all" style="clear:both"/>
        <div style="display:none" id="map_markers"></div>
    </div>

    <div id="portalmap">
        <div class="portalmap_portlet">
            <div class="portalmap_portlet_title">
                <p i18n:translate="">Find address</p>
            </div>
            <div>
                <input type="text" id="address" name="address:ustring:utf8" readonly="readonly" tal:attributes="value request/address|string:" onkeypress="return handleKeyPress(this, event);" />
                <input type="button" name="address_button" id="address_button" value="Go" disabled="disabled" onclick="findAddress()" i18n:attributes="value"/>
            </div>
        </div>
    </div>

    <div id="portalmap">
        <div class="portalmap_portlet">
        <div class="portalmap_portlet_title">
            <p i18n:translate="">Drag & Drop pin to rate</p>
        </div>

        <div>
            <img src="++resource++naaya.observatory.maptool/images/pin.png" id="pin" alt="Pin" style="z-index: 9999;" title="Pin"  />
        </div>
        </div>
    </div>
</form>

<script type="text/javascript">
// not using document.ready because then IE6 won't load yahoo maps :(
showPageElements();
window.map_engine = naaya_map_engine.portal_map('map');
</script>
</tal:block>

</metal:block>
</metal:block>
